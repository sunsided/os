<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Kernel Memory Management"><title>kernel::alloc - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="kernel" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.0-nightly (b6d7ff3aa 2025-11-14)" data-channel="nightly" data-search-js="search-680b2199.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module alloc</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../kernel/index.html">kernel</a><span class="version">0.0.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module alloc</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#kernel-memory-management" title="Kernel Memory Management">Kernel Memory Management</a><ul><li><a href="#architecture" title="Architecture">Architecture</a></li><li><a href="#key-types" title="Key Types">Key Types</a></li><li><a href="#initialization" title="Initialization">Initialization</a></li><li><a href="#usage-patterns" title="Usage Patterns">Usage Patterns</a></li><li><a href="#safety" title="Safety">Safety</a></li><li><a href="#debugging" title="Debugging">Debugging</a></li></ul></li></ul><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#statics" title="Statics">Statics</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate kernel</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">kernel</a></div><h1>Module <span>alloc</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/kernel/alloc.rs.html#1-143">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="kernel-memory-management"><a class="doc-anchor" href="#kernel-memory-management">Â§</a>Kernel Memory Management</h2>
<p>This module provides the core memory management infrastructure for the kernel,
including physical frame allocation, virtual memory management, and page table
manipulation. It serves as the central interface between the kernel and the
underlying memory management subsystems.</p>
<h3 id="architecture"><a class="doc-anchor" href="#architecture">Â§</a>Architecture</h3>
<p>The memory management system is built on three key components:</p>
<ul>
<li><strong>Physical Frame Allocator</strong>: <a href="../../kernel_alloc/frame_alloc/struct.BitmapFrameAlloc.html" title="struct kernel_alloc::frame_alloc::BitmapFrameAlloc"><code>BitmapFrameAlloc</code></a> manages 4KiB physical frames
using a bitmap-based approach for tracking free/used pages</li>
<li><strong>Physical Mapper</strong>: <a href="../../kernel_alloc/phys_mapper/struct.HhdmPhysMapper.html" title="struct kernel_alloc::phys_mapper::HhdmPhysMapper"><code>HhdmPhysMapper</code></a> provides Higher Half Direct Mapping (HHDM)
for efficient access to physical memory from kernel virtual addresses</li>
<li><strong>Virtual Memory Manager</strong>: <a href="../../kernel_alloc/vmm/struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm"><code>Vmm</code></a> handles page table manipulation, mapping/unmapping
operations, and address space management</li>
</ul>
<h3 id="key-types"><a class="doc-anchor" href="#key-types">Â§</a>Key Types</h3>
<ul>
<li><a href="type.KernelVmm.html" title="type kernel::alloc::KernelVmm"><code>KernelVmm</code></a> - Type alias for the kernelâ€™s Virtual Memory Manager configured
with HHDM mapper and bitmap allocator</li>
<li><a href="struct.KernelVm.html" title="struct kernel::alloc::KernelVm"><code>KernelVm</code></a> - Container holding the mapper and allocator with thread-safe access</li>
<li><a href="enum.FlushTlb.html" title="enum kernel::alloc::FlushTlb"><code>FlushTlb</code></a> - Policy enum controlling when TLB flushes occur during operations</li>
</ul>
<h3 id="initialization"><a class="doc-anchor" href="#initialization">Â§</a>Initialization</h3>
<p>Memory management is initialized in two phases:</p>
<ol>
<li><strong>Physical Allocator Setup</strong>: <a href="fn.init_physical_memory_allocator_once.html" title="fn kernel::alloc::init_physical_memory_allocator_once"><code>init_physical_memory_allocator_once</code></a> creates
the bitmap allocator in a dedicated BSS section (<code>.bss.pmm</code>)</li>
<li><strong>VMM Initialization</strong>: <a href="fn.init_kernel_vmm.html" title="fn kernel::alloc::init_kernel_vmm"><code>init_kernel_vmm</code></a> combines the allocator and mapper
into a globally accessible kernel VMM instance</li>
</ol>
<h3 id="usage-patterns"><a class="doc-anchor" href="#usage-patterns">Â§</a>Usage Patterns</h3>
<p>The module provides two primary access patterns:</p>
<ul>
<li><a href="fn.with_kernel_vmm.html" title="fn kernel::alloc::with_kernel_vmm"><code>with_kernel_vmm</code></a> - Execute operations with automatic VMM lifecycle management</li>
<li><a href="fn.try_with_kernel_vmm.html" title="fn kernel::alloc::try_with_kernel_vmm"><code>try_with_kernel_vmm</code></a> - Execute fallible operations with configurable TLB flushing</li>
</ul>
<h3 id="safety"><a class="doc-anchor" href="#safety">Â§</a>Safety</h3>
<p>This module contains extensive unsafe code for:</p>
<ul>
<li>Direct physical memory access via HHDM</li>
<li>Page table manipulation and TLB management</li>
<li>Static initialization of allocator structures</li>
<li>Raw pointer operations for memory mapping</li>
</ul>
<p>All unsafe operations are carefully isolated behind safe abstractions and
documented for their safety requirements.</p>
<h3 id="debugging"><a class="doc-anchor" href="#debugging">Â§</a>Debugging</h3>
<p>The <a href="debug/index.html" title="mod kernel::alloc::debug"><code>debug</code></a> submodule provides utilities for inspecting page table state,
walking virtual address translations, and debugging memory management issues.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="mod" href="debug/index.html" title="mod kernel::alloc::debug">debug</a></dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.KernelVm.html" title="struct kernel::alloc::KernelVm">Kernel<wbr>Vm</a></dt></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.FlushTlb.html" title="enum kernel::alloc::FlushTlb">Flush<wbr>Tlb</a></dt></dl><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="static" href="static.KVM.html" title="static kernel::alloc::KVM">KVM</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt><dt><a class="static" href="static.PMM.html" title="static kernel::alloc::PMM">PMM</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.init_kernel_vmm.html" title="fn kernel::alloc::init_kernel_vmm">init_<wbr>kernel_<wbr>vmm</a><sup title="unsafe function">âš </sup></dt><dd>Call once in very early boot.</dd><dt><a class="fn" href="fn.init_physical_memory_allocator_once.html" title="fn kernel::alloc::init_physical_memory_allocator_once">init_<wbr>physical_<wbr>memory_<wbr>allocator_<wbr>once</a><sup title="unsafe function">âš </sup></dt><dt><a class="fn" href="fn.try_with_kernel_vmm.html" title="fn kernel::alloc::try_with_kernel_vmm">try_<wbr>with_<wbr>kernel_<wbr>vmm</a></dt><dt><a class="fn" href="fn.with_kernel_vmm.html" title="fn kernel::alloc::with_kernel_vmm">with_<wbr>kernel_<wbr>vmm</a></dt></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="type" href="type.KernelVmm.html" title="type kernel::alloc::KernelVmm">Kernel<wbr>Vmm</a></dt></dl></section></div></main></body></html>