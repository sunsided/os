<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Minimal kernel virtual memory manager."><title>Vmm in kernel_alloc::vmm - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="kernel_alloc" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.0-nightly (b6d7ff3aa 2025-11-14)" data-channel="nightly" data-search-js="search-680b2199.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-a410ff4d.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc struct"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Vmm</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../kernel_alloc/index.html">kernel_<wbr>alloc</a><span class="version">0.0.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Vmm</a></h2><h3><a href="#fields">Fields</a></h3><ul class="block structfield"><li><a href="#structfield.alloc" title="alloc">alloc</a></li><li><a href="#structfield.ptables" title="ptables">ptables</a></li></ul><h3><a href="#implementations">Methods</a></h3><ul class="block method"><li><a href="#method.clear_lower_half" title="clear_lower_half">clear_lower_half</a></li><li><a href="#method.copy_to_mapped_user" title="copy_to_mapped_user">copy_to_mapped_user</a></li><li><a href="#method.from_current" title="from_current">from_current</a></li><li><a href="#method.invlpg" title="invlpg">invlpg</a></li><li><a href="#method.local_tlb_flush_all" title="local_tlb_flush_all">local_tlb_flush_all</a></li><li><a href="#method.make_region_rx" title="make_region_rx">make_region_rx</a></li><li><a href="#method.map_anon_4k_pages" title="map_anon_4k_pages">map_anon_4k_pages</a></li><li><a href="#method.map_one" title="map_one">map_one</a></li><li><a href="#method.map_region" title="map_region">map_region</a></li><li><a href="#method.query" title="query">query</a></li><li><a href="#method.unmap_one_4k" title="unmap_one_4k">unmap_one_4k</a></li><li><a href="#method.unmap_region" title="unmap_region">unmap_region</a></li></ul><h3><a href="#synthetic-implementations">Auto Trait Implementations</a></h3><ul class="block synthetic-implementation"><li><a href="#impl-UnwindSafe-for-Vmm%3C'm,+M,+A%3E" title="!UnwindSafe">!UnwindSafe</a></li><li><a href="#impl-Freeze-for-Vmm%3C'm,+M,+A%3E" title="Freeze">Freeze</a></li><li><a href="#impl-RefUnwindSafe-for-Vmm%3C'm,+M,+A%3E" title="RefUnwindSafe">RefUnwindSafe</a></li><li><a href="#impl-Send-for-Vmm%3C'm,+M,+A%3E" title="Send">Send</a></li><li><a href="#impl-Sync-for-Vmm%3C'm,+M,+A%3E" title="Sync">Sync</a></li><li><a href="#impl-Unpin-for-Vmm%3C'm,+M,+A%3E" title="Unpin">Unpin</a></li></ul><h3><a href="#blanket-implementations">Blanket Implementations</a></h3><ul class="block blanket-implementation"><li><a href="#impl-Any-for-T" title="Any">Any</a></li><li><a href="#impl-Borrow%3CT%3E-for-T" title="Borrow&#60;T&#62;">Borrow&#60;T&#62;</a></li><li><a href="#impl-BorrowMut%3CT%3E-for-T" title="BorrowMut&#60;T&#62;">BorrowMut&#60;T&#62;</a></li><li><a href="#impl-From%3CT%3E-for-T" title="From&#60;T&#62;">From&#60;T&#62;</a></li><li><a href="#impl-Into%3CU%3E-for-T" title="Into&#60;U&#62;">Into&#60;U&#62;</a></li><li><a href="#impl-TryFrom%3CU%3E-for-T" title="TryFrom&#60;U&#62;">TryFrom&#60;U&#62;</a></li><li><a href="#impl-TryInto%3CU%3E-for-T" title="TryInto&#60;U&#62;">TryInto&#60;U&#62;</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="index.html">In kernel_<wbr>alloc::<wbr>vmm</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">kernel_alloc</a>::<wbr><a href="index.html">vmm</a></div><h1>Struct <span class="struct">Vmm</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/kernel_alloc/vmm.rs.html#54-59">Source</a> </span></div><pre class="rust item-decl"><code>pub struct Vmm&lt;'m, M: <a class="trait" href="../../kernel_vmem/trait.PhysMapper.html" title="trait kernel_vmem::PhysMapper">PhysMapper</a>, A: <a class="trait" href="../../kernel_vmem/trait.PhysFrameAlloc.html" title="trait kernel_vmem::PhysFrameAlloc">PhysFrameAlloc</a>&gt; {
    ptables: <a class="struct" href="../../kernel_vmem/address_space/struct.AddressSpace.html" title="struct kernel_vmem::address_space::AddressSpace">AddressSpace</a>&lt;'m, M&gt;,
    alloc: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;'m mut A</a>,
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Minimal kernel virtual memory manager.</p>
</div></details><h2 id="fields" class="fields section-header">Fields<a href="#fields" class="anchor">§</a></h2><span id="structfield.ptables" class="structfield section-header"><a href="#structfield.ptables" class="anchor field">§</a><code>ptables: <a class="struct" href="../../kernel_vmem/address_space/struct.AddressSpace.html" title="struct kernel_vmem::address_space::AddressSpace">AddressSpace</a>&lt;'m, M&gt;</code></span><div class="docblock"><p>The page tables.</p>
</div><span id="structfield.alloc" class="structfield section-header"><a href="#structfield.alloc" class="anchor field">§</a><code>alloc: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;'m mut A</a></code></span><div class="docblock"><p>The allocator; hands out pages to work with.</p>
</div><h2 id="implementations" class="section-header">Implementations<a href="#implementations" class="anchor">§</a></h2><div id="implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-Vmm%3C'm,+M,+A%3E" class="impl"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#61-285">Source</a><a href="#impl-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M: <a class="trait" href="../../kernel_vmem/trait.PhysMapper.html" title="trait kernel_vmem::PhysMapper">PhysMapper</a>, A: <a class="trait" href="../../kernel_vmem/trait.PhysFrameAlloc.html" title="trait kernel_vmem::PhysFrameAlloc">PhysFrameAlloc</a>&gt; <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.from_current" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#65-71">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.from_current" class="fn">from_current</a>(mapper: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;'m M</a>, alloc: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;'m mut A</a>) -&gt; Self</h4></section></summary><div class="docblock"><h5 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h5>
<ul>
<li>Must run at CPL0 with paging enabled.</li>
<li>Assumes CR3 points at a valid PML4 frame.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.clear_lower_half" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#77-79">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.clear_lower_half" class="fn">clear_lower_half</a>(&amp;mut self)</h4></section></summary><div class="docblock"><h5 id="safety-1"><a class="doc-anchor" href="#safety-1">§</a>Safety</h5>
<p>This completely unmaps all lower-half PML4 records of the page table
without walking, nor actively unmapping PDPT, PD and PT records. This
is meant to be used exactly once after the kernel is set up, and never again.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.query" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#83-85">Source</a><h4 class="code-header">pub fn <a href="#method.query" class="fn">query</a>(&amp;self, va: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="../../kernel_memory_addresses/physical_address/struct.PhysicalAddress.html" title="struct kernel_memory_addresses::physical_address::PhysicalAddress">PhysicalAddress</a>&gt;</h4></section></summary><div class="docblock"><p>Translate VA→PA if mapped (handles 1G/2M/4K leaves with offset).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.map_one" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#89-100">Source</a><h4 class="code-header">pub fn <a href="#method.map_one" class="fn">map_one</a>&lt;S: <a class="trait" href="../../kernel_vmem/address_space/map_size/trait.MapSize.html" title="trait kernel_vmem::address_space::map_size::MapSize">MapSize</a>&gt;(
    &amp;mut self,
    target: <a class="enum" href="enum.AllocationTarget.html" title="enum kernel_alloc::vmm::AllocationTarget">AllocationTarget</a>,
    va: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>,
    pa: <a class="struct" href="../../kernel_memory_addresses/physical_address/struct.PhysicalAddress.html" title="struct kernel_memory_addresses::physical_address::PhysicalAddress">PhysicalAddress</a>,
    nonleaf_flags: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
    leaf_flags: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.unit.html">()</a>, <a class="enum" href="../../kernel_vmem/address_space/enum.AddressSpaceMapOneError.html" title="enum kernel_vmem::address_space::AddressSpaceMapOneError">AddressSpaceMapOneError</a>&gt;</h4></section></summary><div class="docblock"><p>Map <strong>one</strong> page of size <code>S</code> with <code>leaf_flags</code>, creating parents with <code>nonleaf_flags</code>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.unmap_one_4k" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#104-106">Source</a><h4 class="code-header">pub fn <a href="#method.unmap_one_4k" class="fn">unmap_one_4k</a>(&amp;mut self, va: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.unit.html">()</a>, &amp;'static <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.str.html">str</a>&gt;</h4></section></summary><div class="docblock"><p>Unmap a single <strong>4 KiB</strong> page at <code>va</code>. Returns Err if not a 4K mapping.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.map_region" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#113-126">Source</a><h4 class="code-header">pub fn <a href="#method.map_region" class="fn">map_region</a>(
    &amp;mut self,
    target: <a class="enum" href="enum.AllocationTarget.html" title="enum kernel_alloc::vmm::AllocationTarget">AllocationTarget</a>,
    va: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>,
    pa: <a class="struct" href="../../kernel_memory_addresses/physical_address/struct.PhysicalAddress.html" title="struct kernel_memory_addresses::physical_address::PhysicalAddress">PhysicalAddress</a>,
    len: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.u64.html">u64</a>,
    nonleaf: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
    leaf: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.unit.html">()</a>, <a class="enum" href="enum.VmmError.html" title="enum kernel_alloc::vmm::VmmError">VmmError</a>&gt;</h4></section></summary><div class="docblock"><p>Greedy region map: tiles <code>[va .. va+len)</code> to <code>[pa .. pa+len)</code> with 1G/2M/4K leaves.</p>
<h5 id="errors"><a class="doc-anchor" href="#errors">§</a>Errors</h5>
<p>Allocation fails, e.g. due to OOM.</p>
</div></details><section id="method.unmap_region" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#128-130">Source</a><h4 class="code-header">pub fn <a href="#method.unmap_region" class="fn">unmap_region</a>(&amp;mut self, va: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>, len: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.u64.html">u64</a>)</h4></section><details class="toggle method-toggle" open><summary><section id="method.map_anon_4k_pages" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#136-163">Source</a><h4 class="code-header">pub fn <a href="#method.map_anon_4k_pages" class="fn">map_anon_4k_pages</a>(
    &amp;mut self,
    target: <a class="enum" href="enum.AllocationTarget.html" title="enum kernel_alloc::vmm::AllocationTarget">AllocationTarget</a>,
    va_start: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>,
    guard: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.u64.html">u64</a>,
    bytes: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.u64.html">u64</a>,
    nonleaf: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
    leaf: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.unit.html">()</a>, <a class="enum" href="enum.VmmError.html" title="enum kernel_alloc::vmm::VmmError">VmmError</a>&gt;</h4></section></summary><div class="docblock"><p>Convenience: map a <strong>per-page</strong> region using freshly allocated 4K frames (no PA contiguity).</p>
<p>Leaves <code>guard</code> bytes at the beginning <strong>unmapped</strong> (for stacks).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.copy_to_mapped_user" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#171-202">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.copy_to_mapped_user" class="fn">copy_to_mapped_user</a>(
    &amp;mut self,
    dst_user: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>,
    src: &amp;[<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.u8.html">u8</a>],
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.unit.html">()</a>, <a class="enum" href="enum.VmmError.html" title="enum kernel_alloc::vmm::VmmError">VmmError</a>&gt;</h4></section></summary><div class="docblock"><p>Copy a kernel slice into an already <strong>mapped</strong> user region.</p>
<h5 id="safety-2"><a class="doc-anchor" href="#safety-2">§</a>Safety</h5>
<ul>
<li><code>dst_user .. dst_user+src.len()</code> must be mapped and writable.</li>
<li>Same address space active (your current setup).</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.make_region_rx" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#207-234">Source</a><h4 class="code-header">pub fn <a href="#method.make_region_rx" class="fn">make_region_rx</a>(
    &amp;mut self,
    va_start: <a class="struct" href="../../kernel_memory_addresses/virtual_address/struct.VirtualAddress.html" title="struct kernel_memory_addresses::virtual_address::VirtualAddress">VirtualAddress</a>,
    len: <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.u64.html">u64</a>,
    nonleaf: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
    leaf_rx: <a class="struct" href="../../kernel_vmem/bits/struct.VirtualMemoryPageBits.html" title="struct kernel_vmem::bits::VirtualMemoryPageBits">VirtualMemoryPageBits</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.unit.html">()</a>, <a class="enum" href="enum.VmmError.html" title="enum kernel_alloc::vmm::VmmError">VmmError</a>&gt;</h4></section></summary><div class="docblock"><p>Change per-page protection from RW to RX by unmapping &amp; remapping with the same PA.
Works for 4K pages created by <code>map_anon_4k_pages</code>.v</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.invlpg" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#254-256">Source</a><h4 class="code-header">pub fn <a href="#method.invlpg" class="fn">invlpg</a>(&amp;self, page: <a class="struct" href="../../kernel_memory_addresses/virtual_page/struct.VirtualPage.html" title="struct kernel_memory_addresses::virtual_page::VirtualPage">VirtualPage</a>&lt;<a class="struct" href="../../kernel_memory_addresses/page_size/struct.Size4K.html" title="struct kernel_memory_addresses::page_size::Size4K">Size4K</a>&gt;)</h4></section></summary><div class="docblock"><p>Invalidate one VA on this CPU (when you modified the active address space).</p>
<p>Calls <a href="../../kernel_vmem/fn.invalidate_tlb_page.html" title="fn kernel_vmem::invalidate_tlb_page"><code>invalidate_tlb_page</code></a> for the given 4 KiB page in the <strong>current</strong>
address space (the CR3 that is active on this CPU).</p>
<h5 id="safety-correctness-requirements"><a class="doc-anchor" href="#safety-correctness-requirements">§</a>Safety (correctness requirements)</h5>
<p>This method is safe to call, but you must ensure the following for it to
actually produce correct behavior:</p>
<ul>
<li>You <strong>only</strong> use it after modifying the <strong>currently active</strong> page tables
(same CR3/PCID that the calling CPU is running under). Invalidating a VA
for a different CR3 does nothing for that other address space.</li>
<li>It affects <strong>only the calling CPU</strong>. On SMP systems you must also issue
invalidations (e.g., via IPIs) on any CPU that might have cached the old
translation.</li>
<li>With PCID and/or global pages enabled, this invalidation might not cover
all translations you expect. Use an appropriate scheme (e.g., INVPCID or
CR4.PGE toggling) if your paging mode relies on those features.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.local_tlb_flush_all" class="method"><a class="src rightside" href="../../src/kernel_alloc/vmm.rs.html#280-284">Source</a><h4 class="code-header">pub unsafe fn <a href="#method.local_tlb_flush_all" class="fn">local_tlb_flush_all</a>(&amp;self)</h4></section></summary><div class="docblock"><p>Flushes the (non-global) TLB entries for the <strong>current address space</strong> on this CPU
by reloading CR3 with its current value.</p>
<p>On <code>x86/x86_64</code>, <code>mov cr3, cr3</code> invalidates cached translations associated with the
active CR3/PCID on the <strong>local CPU</strong>. It does <strong>not</strong> invalidate global mappings.</p>
<h5 id="safety-3"><a class="doc-anchor" href="#safety-3">§</a>Safety</h5>
<p>Calling this is <code>unsafe</code> because misuse can corrupt memory or hang the system.
The caller must guarantee:</p>
<ul>
<li><strong>Privilege:</strong> Running in a context where CR3 access is permitted (e.g., ring 0).</li>
<li><strong>Address space intent:</strong> You intend to flush the <strong>current</strong> CR3/PCID only.
Other address spaces are unaffected.</li>
<li><strong>Global mappings:</strong> This does <strong>not</strong> flush global (PGE) entries. If you rely
on global mappings, use an alternative strategy (e.g., clear/set CR4.PGE or use
INVPCID where available).</li>
<li><strong>PCID semantics:</strong> With PCID enabled, this flush targets the active PCID only.
Ensure that matches your invalidation intent.</li>
<li><strong>SMP:</strong> It affects <strong>only</strong> the calling CPU. Coordinate remote TLB shootdowns
(e.g., via IPIs) for other CPUs that could have cached stale entries.</li>
<li><strong>Concurrency:</strong> Ensure that other cores/interrupts can’t concurrently depend
on the stale translations you’re invalidating (disable interrupts or otherwise
synchronize as appropriate).</li>
</ul>
</div></details></div></details></div><h2 id="synthetic-implementations" class="section-header">Auto Trait Implementations<a href="#synthetic-implementations" class="anchor">§</a></h2><div id="synthetic-implementations-list"><section id="impl-Freeze-for-Vmm%3C'm,+M,+A%3E" class="impl"><a href="#impl-Freeze-for-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M, A&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Freeze.html" title="trait core::marker::Freeze">Freeze</a> for <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;</h3></section><section id="impl-RefUnwindSafe-for-Vmm%3C'm,+M,+A%3E" class="impl"><a href="#impl-RefUnwindSafe-for-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M, A&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.RefUnwindSafe.html" title="trait core::panic::unwind_safe::RefUnwindSafe">RefUnwindSafe</a> for <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;<div class="where">where
    A: <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.RefUnwindSafe.html" title="trait core::panic::unwind_safe::RefUnwindSafe">RefUnwindSafe</a>,
    M: <a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.RefUnwindSafe.html" title="trait core::panic::unwind_safe::RefUnwindSafe">RefUnwindSafe</a>,</div></h3></section><section id="impl-Send-for-Vmm%3C'm,+M,+A%3E" class="impl"><a href="#impl-Send-for-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M, A&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> for <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;<div class="where">where
    A: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a>,
    M: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a>,</div></h3></section><section id="impl-Sync-for-Vmm%3C'm,+M,+A%3E" class="impl"><a href="#impl-Sync-for-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M, A&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> for <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;<div class="where">where
    A: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a>,
    M: <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a>,</div></h3></section><section id="impl-Unpin-for-Vmm%3C'm,+M,+A%3E" class="impl"><a href="#impl-Unpin-for-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M, A&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Unpin.html" title="trait core::marker::Unpin">Unpin</a> for <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;</h3></section><section id="impl-UnwindSafe-for-Vmm%3C'm,+M,+A%3E" class="impl"><a href="#impl-UnwindSafe-for-Vmm%3C'm,+M,+A%3E" class="anchor">§</a><h3 class="code-header">impl&lt;'m, M, A&gt; !<a class="trait" href="https://doc.rust-lang.org/nightly/core/panic/unwind_safe/trait.UnwindSafe.html" title="trait core::panic::unwind_safe::UnwindSafe">UnwindSafe</a> for <a class="struct" href="struct.Vmm.html" title="struct kernel_alloc::vmm::Vmm">Vmm</a>&lt;'m, M, A&gt;</h3></section></div><h2 id="blanket-implementations" class="section-header">Blanket Implementations<a href="#blanket-implementations" class="anchor">§</a></h2><div id="blanket-implementations-list"><details class="toggle implementors-toggle"><summary><section id="impl-Any-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/any.rs.html#138">Source</a><a href="#impl-Any-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html" title="trait core::any::Any">Any</a> for T<div class="where">where
    T: 'static + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.type_id" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/any.rs.html#139">Source</a><a href="#method.type_id" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html#tymethod.type_id" class="fn">type_id</a>(&amp;self) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/any/struct.TypeId.html" title="struct core::any::TypeId">TypeId</a></h4></section></summary><div class='docblock'>Gets the <code>TypeId</code> of <code>self</code>. <a href="https://doc.rust-lang.org/nightly/core/any/trait.Any.html#tymethod.type_id">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Borrow%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#212">Source</a><a href="#impl-Borrow%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html" title="trait core::borrow::Borrow">Borrow</a>&lt;T&gt; for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#214">Source</a><a href="#method.borrow" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html#tymethod.borrow" class="fn">borrow</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;T</a></h4></section></summary><div class='docblock'>Immutably borrows from an owned value. <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.Borrow.html#tymethod.borrow">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-BorrowMut%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#221">Source</a><a href="#impl-BorrowMut%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html" title="trait core::borrow::BorrowMut">BorrowMut</a>&lt;T&gt; for T<div class="where">where
    T: ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.borrow_mut" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/borrow.rs.html#222">Source</a><a href="#method.borrow_mut" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut" class="fn">borrow_mut</a>(&amp;mut self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/core/primitive.reference.html">&amp;mut T</a></h4></section></summary><div class='docblock'>Mutably borrows from an owned value. <a href="https://doc.rust-lang.org/nightly/core/borrow/trait.BorrowMut.html#tymethod.borrow_mut">Read more</a></div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-From%3CT%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#785">Source</a><a href="#impl-From%3CT%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for T</h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.from" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#788">Source</a><a href="#method.from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html#tymethod.from" class="fn">from</a>(t: T) -&gt; T</h4></section></summary><div class="docblock"><p>Returns the argument unchanged.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Into%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#767-769">Source</a><a href="#impl-Into%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.into" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#777">Source</a><a href="#method.into" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html#tymethod.into" class="fn">into</a>(self) -&gt; U</h4></section></summary><div class="docblock"><p>Calls <code>U::from(self)</code>.</p>
<p>That is, this conversion is whatever the implementation of
<code><a href="https://doc.rust-lang.org/nightly/core/convert/trait.From.html" title="trait core::convert::From">From</a>&lt;T&gt; for U</code> chooses to do.</p>
</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryFrom%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#827-829">Source</a><a href="#impl-TryFrom%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error-1" class="associatedtype trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#831">Source</a><a href="#associatedtype.Error-1" class="anchor">§</a><h4 class="code-header">type <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" class="associatedtype">Error</a> = <a class="enum" href="https://doc.rust-lang.org/nightly/core/convert/enum.Infallible.html" title="enum core::convert::Infallible">Infallible</a></h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_from" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#834">Source</a><a href="#method.try_from" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#tymethod.try_from" class="fn">try_from</a>(value: U) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;T, &lt;T as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;U&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details><details class="toggle implementors-toggle"><summary><section id="impl-TryInto%3CU%3E-for-T" class="impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#811-813">Source</a><a href="#impl-TryInto%3CU%3E-for-T" class="anchor">§</a><h3 class="code-header">impl&lt;T, U&gt; <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html" title="trait core::convert::TryInto">TryInto</a>&lt;U&gt; for T<div class="where">where
    U: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;,</div></h3></section></summary><div class="impl-items"><details class="toggle" open><summary><section id="associatedtype.Error" class="associatedtype trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#815">Source</a><a href="#associatedtype.Error" class="anchor">§</a><h4 class="code-header">type <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html#associatedtype.Error" class="associatedtype">Error</a> = &lt;U as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a></h4></section></summary><div class='docblock'>The type returned in the event of a conversion error.</div></details><details class="toggle method-toggle" open><summary><section id="method.try_into" class="method trait-impl"><a class="src rightside" href="https://doc.rust-lang.org/nightly/src/core/convert/mod.rs.html#818">Source</a><a href="#method.try_into" class="anchor">§</a><h4 class="code-header">fn <a href="https://doc.rust-lang.org/nightly/core/convert/trait.TryInto.html#tymethod.try_into" class="fn">try_into</a>(self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;U, &lt;U as <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom">TryFrom</a>&lt;T&gt;&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/convert/trait.TryFrom.html#associatedtype.Error" title="type core::convert::TryFrom::Error">Error</a>&gt;</h4></section></summary><div class='docblock'>Performs the conversion.</div></details></div></details></div></section></div></main></body></html>